<!DOCTYPE html>
<html>
<head>
    <title>Congressional Career Paths</title>
    <style>
        .path {
            fill: none;
            stroke-width: 2;
            opacity: 0.7;
        }

        .node {
            fill: white;
            stroke: black;
            stroke-width: 1;
        }

        .node-label {
            font-size: 12px;
            font-family: Arial, sans-serif;
            text-anchor: middle;
        }

        .politician-label {
            font-size: 12px;
            font-family: Arial, sans-serif;
            text-anchor: start;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="js/careerPathProcessor.js"></script>
</head>
<body>
    <div id="visualization"></div>
    <script>
        // Data structure for career stages and their positions
        const stages = [
            // everyone goes through this one
            {id: 'startNode', x:50, y: 300, label: ''},

       // 'prevUnsuccessfulCandidate', 'partyPolitics', 'religion',
       // 'blueCollarOrServiceJob', 'education',
       // 'sports', 'media', 'realEstate',
       // 'lawEnforcement', 'farmingOrRanching', 'businessOrManagement',
       // 'lobbyingOrPacs', 'localGov', 'stateLeg', 'electedFedOrStateOffice',
       // 'nonElectedGovJob'

            // Education stages
            {id: 'eliteCollege', x: 100, y: 100, label: 'Elite college'},
            {id: 'noBA', x: 100, y: 200, label: 'No BA'},
            {id: 'privateCollege', x: 100, y: 150, label: 'Private college'},
            {id: 'publicCollege', x: 100, y: 300, label: 'Public college'},
            {id: 'communityCollege', x: 75, y: 350, label: 'Community college'},
            
            // Graduate education
            {id: 'lawSchool', x: 200, y: 150, label: 'Law school'},
            {id: 'medDegree', x: 210, y: 200, label: 'Medical degree'},
            {id: 'doctorate', x: 220, y: 230, label: 'doctorate'},
            {id: 'mba', x: 200, y: 250, label: 'MBA'},
            {id: 'otherMasters', x: 175, y: 300, label: 'Master\'s'},
            
            // Career stages
            {id: 'lawyerPrivatePractice', x: 300, y: 100, label: 'Lawyer (private practice)'},
            {id: 'sciOrEng', x: 300, y: 200, label: 'sciOrEng'},
            {id: 'religion', x: 300, y: 250, label: 'religion'},
            {id: 'blueCollarOrServiceJob', x: 300, y: 300, label: 'blueCollarOrServiceJob'},
            {id: 'sports', x: 300, y: 350, label: 'Sports'},
            {id: 'military', x: 270, y: 220, label: 'Military'},
            {id: 'businessOrManagement', x: 300, y: 450, label: 'Business'},
            {id: 'media', x: 300, y: 400, label: 'Media'},
            {id: 'realEstate', x: 300, y: 500, label: 'Real estate'},

            {id: 'healthcare', x: 350, y: 100, label: 'healthcare'},
            {id: 'education', x: 350, y: 200, label: 'education'},
            {id: 'farmingOrRanching', x: 350, y: 470, label: 'farmingOrRanching'},
            {id: 'healthcare', x: 350, y: 520, label: 'healthcare'},


            
            // Government/Public service
            {id: 'nonprofitsAndUnions', x: 400, y: 150, label: 'Nonprofits'},
            {id: 'publicLawyerOrJudge', x: 400, y: 300, label: 'Public lawyer'},
            {id: 'nonElectedGovJob', x: 400, y: 230, label: 'Non-elected gov'},
            {id: 'stateLeg', x: 400, y: 350, label: 'stateLeg'},
            {id: 'localGov', x: 400, y: 490, label: 'localGov'},//prevUnsuccessfulCandidate
            {id: 'prevUnsuccessfulCandidate', x: 450, y: 400, label: 'prevUnsuccessfulCandidate'},

            
            // Final destination
            {id: 'congress', x: 500, y: 250, label: 'Congress'}
        ];

        function processCareerStages(politician) {
            const careerStages = [];
            careerStages.push('startNode');

            // Helper function to check if a stage should be included
            const shouldIncludeStage = (value) => {
                // Check if the value indicates a true stage
                // This handles both boolean False and string "False"
                if (value === false || value === "False") {
                    return false;
                }
                // If it's a non-empty string (except "False"), it's a valid stage
                if (typeof value === "string" && value.trim().length > 0) {
                    return true;
                }
                return false;
            };

            // Education stages
            if (shouldIncludeStage(politician.privateCollege)) careerStages.push('privateCollege');
            if (shouldIncludeStage(politician.publicCollege)) careerStages.push('publicCollege');
            if (shouldIncludeStage(politician.communityCollege)) careerStages.push('communityCollege');
            if (shouldIncludeStage(politician.eliteCollege)) careerStages.push('eliteCollege');
            if (shouldIncludeStage(politician.noBA)) careerStages.push('noBA');

            // Graduate education
            if (shouldIncludeStage(politician.lawSchool)) careerStages.push('lawSchool');
            if (shouldIncludeStage(politician.mba)) careerStages.push('mba');
            if (shouldIncludeStage(politician.otherMasters)) careerStages.push('otherMasters');
            if (shouldIncludeStage(politician.medDegree)) careerStages.push('medDegree');
            if (shouldIncludeStage(politician.doctorate)) careerStages.push('doctorate');

            // Career stages
            if (shouldIncludeStage(politician.sports)) careerStages.push('sports');
            if (shouldIncludeStage(politician.military)) careerStages.push('military');
            if (shouldIncludeStage(politician.businessOrManagement)) careerStages.push('businessOrManagement');
            if (shouldIncludeStage(politician.media)) careerStages.push('media');
            if (shouldIncludeStage(politician.realEstate)) careerStages.push('realEstate');
            if (shouldIncludeStage(politician.lawyerPrivatePractice)) careerStages.push('lawyerPrivatePractice');
            if (shouldIncludeStage(politician.sciOrEng)) careerStages.push('sciOrEng');
            if (shouldIncludeStage(politician.religion)) careerStages.push('religion');
            if (shouldIncludeStage(politician.blueCollarOrServiceJob)) careerStages.push('blueCollarOrServiceJob');
            if (shouldIncludeStage(politician.healthcare)) careerStages.push('healthcare');
            if (shouldIncludeStage(politician.education)) careerStages.push('education');
            if (shouldIncludeStage(politician.farmingOrRanching)) careerStages.push('farmingOrRanching');

            // Government/public service stages
            if (shouldIncludeStage(politician.nonprofitsAndUnions)) careerStages.push('nonprofitsAndUnions');
            if (shouldIncludeStage(politician.publicLawyerOrJudge)) careerStages.push('publicLawyerOrJudge');
            if (shouldIncludeStage(politician.nonElectedGovJob)) careerStages.push('nonElectedGovJob');
            if (shouldIncludeStage(politician.stateLeg)) careerStages.push('stateLeg');
            if (shouldIncludeStage(politician.localGov)) careerStages.push('localGov');
            if (shouldIncludeStage(politician.prevUnsuccessfulCandidate)) careerStages.push('prevUnsuccessfulCandidate');

            // Add Congress as final stage
            careerStages.push('congress');

            // Add debugging log
            console.log('Career Stages Found:', careerStages.map(stage => ({
                stage,
                value: politician[stage] || 'N/A'
            })));

            return {
                id: politician.id,
                name: `${politician.givenName} ${politician.familyName}`,
                stages: careerStages,
                color: politician.party === 'D' ? '#0052A5' : // Democratic blue
                    politician.party === 'R' ? '#CC0000' : // Republican red
                    '#808080', // Gray for Independent
                party: politician.party,
                state: politician.state,
            };
        }

        // Fetch and process the JSON data
        d3.json('../data/118-processed-bios.json').then(data => {
            // Process all politicians and randomly select 5
            const allPoliticians = Object.values(data).map(politician => 
                processCareerStages(politician)
            );
            
            // Randomly sample 5 politicians
            const sampledPoliticians = allPoliticians
                .sort(() => 0.5 - Math.random())
                .slice(0, 10);
            
            console.log("Sampled politicians:", sampledPoliticians.map(p => p.name));
            
            // Set up the SVG
            const width = 800;
            const height = 600;
            const margin = {top: 50, right: 100, bottom: 50, left: 100};

            const svg = d3.select('#visualization')
                .append('svg')
                .attr('width', width)
                .attr('height', height);

            // Create tooltip div
            const tooltip = d3.select('#visualization')
                .append('div')
                .attr('class', 'tooltip')
                .style('opacity', 0)
                .style('position', 'absolute')
                .style('background', 'white')
                .style('border', '1px solid #ddd')
                .style('border-radius', '4px')
                .style('padding', '8px')
                .style('pointer-events', 'none')
                .style('box-shadow', '0 2px 4px rgba(0,0,0,0.1)');

            // Draw nodes
            svg.selectAll('circle')
                .data(stages)
                .enter()
                .append('circle')
                .attr('class', 'node')
                .attr('cx', d => d.x)
                .attr('cy', d => d.y)
                .attr('r', 5);

            // Add node labels
            svg.selectAll('.node-label')
                .data(stages)
                .enter()
                .append('text')
                .attr('class', 'node-label')
                .attr('x', d => d.x)
                .attr('y', d => d.y - 15)
                .text(d => d.label);

            // Create path generator
            const line = d3.line()
                .x(d => d.x)
                .y(d => d.y)
                .curve(d3.curveCatmullRom.alpha(0.5));

            // Create a group for all paths
            const pathGroup = svg.append('g')
                .attr('class', 'paths');

            // Draw paths for sampled politicians
            sampledPoliticians.forEach((politician, index) => {
                const pathPoints = politician.stages.map(stageId => {
                    const stage = stages.find(s => s.id === stageId);
                    return {x: stage.x, y: stage.y};
                }).sort((a, b) => a.x - b.x);

                const offset = index * 2;
                const offsetPathPoints = pathPoints.map(point => ({
                    x: point.x,
                    y: point.y + offset
                }));

                // Draw the path
                pathGroup.append('path')
                    .attr('class', 'path')
                    .attr('d', line(offsetPathPoints))
                    .style('stroke', politician.color)
                    .style('opacity', 0.6)
                    .on('mouseover', function(event) {
                        // Highlight path
                        d3.select(this)
                            .style('opacity', 1)
                            .style('stroke-width', '3px');
                        
                        // Show tooltip
                        tooltip.transition()
                            .duration(200)
                            .style('opacity', .9);
                            
                        tooltip.html(`
                            <strong>${politician.name}</strong><br/>
                            ${politician.party} - ${politician.state}
                        `)
                            .style('left', (event.pageX + 10) + 'px')
                            .style('top', (event.pageY - 28) + 'px')
                            .style('color', politician.color);
                    })
                    .on('mousemove', function(event) {
                        // Move tooltip with cursor
                        tooltip
                            .style('left', (event.pageX + 10) + 'px')
                            .style('top', (event.pageY - 28) + 'px');
                    })
                    .on('mouseout', function() {
                        // Reset path highlighting
                        d3.select(this)
                            .style('opacity', 0.6)
                            .style('stroke-width', '1.5px');
                        
                        // Hide tooltip
                        tooltip.transition()
                            .duration(500)
                            .style('opacity', 0);
                    });
            });
        }).catch(error => {
            console.error('Error loading the JSON file:', error);
        });
    </script>
</body>
</html>